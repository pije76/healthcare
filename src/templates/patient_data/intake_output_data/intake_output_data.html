{% extends 'base.html' %}

{% load static %}
{% load staticfiles %}
{% load crispy_forms_tags %}
{% load i18n %}
{% load widget_tweaks %}

{% block headtitle %}
	{{ page_title }} | {{ titles.title }}
{% endblock %}

{% block styles %}
	<link href="{% static 'css/patient_data/intake_output.css' %}" rel="stylesheet" type="text/css">
	<link href="{% static 'css/patient_data/patient_data.css' %}" rel="stylesheet" type="text/css">
{% endblock %}


{% block javascript %}

	<script type="text/javascript">
	$(document).ready(function()
	{
		$('#t_add_row').DataTable(
		{
			"order": [[ 0, "desc" ], [ 1, "asc" ]],
			rowGroup:
			{
				dataSrc: [0],
				startRender: null,
//				startRender: function(rows, group)
//				{
//					return group +' ('+rows.count()+' rows)';
//				},
				endRender: function(rows, group)
				{
					var oralSum = rows
						.data()
						.pluck(3)
						.reduce(function (a, b)
						{
							return a + b*1;
						}, 0);

					var parenteralSum = rows
						.data()
						.pluck(5)
						.reduce(function (a, b)
						{
							return a + b*1;
						}, 0);
					
					var otherintakeSum = rows
						.data()
						.pluck(7)
						.reduce(function (a, b)
						{
							return a + b*1;
						}, 0);

					var cumSum = rows
						.data()
						.pluck(10)
						.reduce(function (a, b)
						{
							return a + b*1;
						}, 0);

					var gastricSum = rows
						.data()
						.pluck(11)
						.reduce(function (a, b)
						{
							return a + b*1;
						}, 0);

					var otheroutputSum = rows
						.data()
						.pluck(13)
						.reduce(function (a, b)
						{
							return a + b*1;
						}, 0);

					return $('<tr/>')
						.append('<td colspan="3">12-HOUR INTAKE: </td>')
						.append('<td>'+ oralSum.toFixed(0) +'</td>')
						.append('<td/>')
						.append('<td>'+ parenteralSum.toFixed(0) +'</td>')
						.append('<td/>')
						.append('<td>'+ otherintakeSum.toFixed(0) +'</td>')
						.append('<td colspan="2">OUTPUT: </td>')
						.append('<td>'+ cumSum.toFixed(0) +'</td>')
						.append('<td>'+ gastricSum.toFixed(0) +'</td>')
						.append('<td/>')
						.append('<td>'+ otheroutputSum.toFixed(0) +'</td>')
						.append('<td/>');
				},
			},
			columnDefs: [
			{
				"searchable": false, "targets": 14,
			}]
		});
	});
	</script>

{% endblock %}


{% block content %}

<div class="page-wrapper">

	<div class="container-fluid">

		<div class="formtitle">
			{{ page_title }}
		</div>

		<div class="row detail">

	<div class="col-12">
		{% if profiles %}
				{% for item in profiles %}
				<div class="col-4">
					<span id="name_title">{% trans "Name" %}:</span>
					<span id="name_field">{{ item.full_name }}</span>
				</div>
				<div class="col-6">
					<span id="class_title">{% trans "IC Number" %}:</span>
					<span id="class_field">{{ item.ic_number }}</span>
				</div>
				{% endfor %}
		{% endif %}
	</div>

</div>

		<div class="row">

			<div class="col-12">
				<div class="card">

					<div class="card-body">

						<div class="table-responsive">
							<form method="post" id="dataForm" data-url="" novalidate>
							{% csrf_token %}
								<table id="t_add_row" class="table table-striped table-bordered display" style="width:100%">
									<thead>
										<tr>
											<th class="text-center" rowspan="3">{% trans "Date" %}</th>
											<th class="text-center" colspan="7">{% trans "Intake" %}</th>
											<th class="text-center" colspan="6">{% trans "Output" %}</th>
											<th class="text-center" rowspan="3" style="border: 1px solid #ddd" >{% trans "Action" %}</th>
										</tr>
										<tr>
											<th class="text-center" rowspan="2">{% trans "Time" %}</th>
											<th class="text-center" colspan="2">{% trans "Oral" %}</th>
											<th class="text-center" colspan="2">{% trans "Parenteral" %}</th>
											<th class="text-center" colspan="2">{% trans "Other" %}</th>
											<th class="text-center" rowspan="2">{% trans "Time" %}</th>
											<th class="text-center" colspan="2">{% trans "Urine" %}</th>
											<th class="text-center">{% trans "Gas-Tric" %}</th>
											<th class="text-center" colspan="2">{% trans "Other" %}</th>
										</tr>
										<tr>
											<th class="text-center">{% trans "Type" %}</th>
											<th class="text-center">{% trans "ml." %}</th>
											<th class="text-center">{% trans "Type" %}</th>
											<th class="text-center">{% trans "ml." %}</th>
											<th class="text-center">{% trans "Type" %}</th>
											<th class="text-center">{% trans "ml." %}</th>
											<th class="text-center">{% trans "ml." %}</th>
											<th class="text-center">{% trans "Cum. Total" %}</th>
											<th class="text-center">{% trans "ml." %}</th>
											<th class="text-center">{% trans "Type" %}</th>
											<th class="text-center">{% trans "ml." %}</th>
										</tr>
									</thead>
									<tbody>

										{% for item in time_range_day %}
										<tr>
											<td>{{ item.date|date:"d-m-Y" }}</td>
											<td>{{ item.time_intake|date:"H:i" }}</td>
											<td>{{ item.intake_oral_type }}</td>
											<td>{{ item.intake_oral_ml }}</td>
											<td>{{ item.intake_parenteral_type }}</td>
											<td>{{ item.intake_parenteral_ml }}</td>
											<td>{{ item.intake_other_type }}</td>
											<td>{{ item.intake_other_ml }}</td>
											<td>{{ item.time_output|date:"H:i" }}</td>
											<td>{{ item.output_urine_ml }}</td>
											<td>{{ item.output_urine_cum }}</td>
											<td>{{ item.output_gastric_ml }}</td>
											<td>{{ item.output_other_type }}</td>
											<td>{{ item.output_other_ml }}</td>
											<td>
												<button type="button" class="btn btn-sm btn-icon btn-pure btn-outline" data-url="{% url 'patient_data:patientdata_edit' item.id %}" title="Edit">
													<i class="fas fa-pencil-alt" style="color: #b2b9bf"></i>
												</button>
												<button type="button" class="btn btn-sm btn-icon btn-pure btn-outline" data-url="{% url 'patient_data:patientdata_delete' item.id %}" title="Delete">
													<i class="fas fa-trash-alt" style="color: #b2b9bf"></i>
												</button>
											</td>
										</tr>
										{% endfor %}

										{% for item in time_range_night %}
										<tr>
											<td>{{ item.date|date:"d-m-Y" }}</td>
											<td>{{ item.time_intake|date:"H:i" }}</td>
											<td>{{ item.intake_oral_type }}</td>
											<td>{{ item.intake_oral_ml }}</td>
											<td>{{ item.intake_parenteral_type }}</td>
											<td>{{ item.intake_parenteral_ml }}</td>
											<td>{{ item.intake_other_type }}</td>
											<td>{{ item.intake_other_ml }}</td>
											<td>{{ item.time_output|date:"H:i" }}</td>
											<td>{{ item.output_urine_ml }}</td>
											<td>{{ item.output_urine_cum }}</td>
											<td>{{ item.output_gastric_ml }}</td>
											<td>{{ item.output_other_type }}</td>
											<td>{{ item.output_other_ml }}</td>
											<td>
												<button type="button" class="btn btn-sm btn-icon btn-pure btn-outline" data-url="{% url 'patient_data:patientdata_edit' item.id %}" title="Edit">
													<i class="fas fa-pencil-alt" style="color: #b2b9bf"></i>
												</button>
												<button type="button" class="btn btn-sm btn-icon btn-pure btn-outline" data-url="{% url 'patient_data:patientdata_delete' item.id %}" title="Delete">
													<i class="fas fa-trash-alt" style="color: #b2b9bf"></i>
												</button>
											</td>
										</tr>
										{% endfor %}

									</tbody>
									<tfoot>
										<tr>
											<td colspan="3"><b>24-HOUR TOTAL</b></td>
											<td colspan="3"><b>INTAKE :</b></td>
											<td><b>{{ total_other_output.output_other_ml__sum }}</b></td>
											<td colspan="3"><b>OUTPUT :</b></td>
											<td><b>{{ total_other_output.output_other_ml__sum }}</b></td>
											<td colspan="3"><b>BALANCE :</b></td>
											<td><b>{{ total_other_output.output_other_ml__sum }}</b></td>
										</tr>
									</tfoot>
								</table>
							</form>
						</div>
						{% for item in profiles %}
						<a class="btn btn-outline-primary" href="{% url 'patient_data:patientdata_detail' item.id %}">{% trans "Back" %}</a>
						{% endfor %}

					</div>

				</div>
			</div>

		</div>

		<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1" style="display: none;" aria-hidden="true">
			<div class="modal-dialog" role="document">

				<div class="modal-content">

				</div>

			</div>
		</div>

	</div>

</div>

{% endblock %} 

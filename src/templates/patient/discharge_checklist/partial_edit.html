{% load crispy_forms_tags %}
{% load i18n %}
{% load static %}

{% block extrahead %}
    {{ form.media }}
{% endblock %}

{% block javascript %}
    <script src="{% static 'js/jquery.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/moment.min.js' %}"></script>
    <script src="{% static 'js/bootstrap-datetimepicker.min.js' %}"></script>
    <script src="{% static 'js/jquery.formset.js' %}"></script>
{% endblock %}

<form method="post" action="">
{% csrf_token %}

	<div class="modal-header">
		<h4 class="modal-title">{% trans "Edit Discharge Checklist" %}</h4>
		<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
	</div>

    {{ form.management_form }}

	<div class="modal-body">
        <div class="form-group">
            {{ form.patient|as_crispy_field }}
            {{ form.date_time|as_crispy_field }}
            {{ form.discharge_status|as_crispy_field }}
            {{ form.nasogastric_tube_date|as_crispy_field }}
            {{ form.nasogastric_tube|as_crispy_field }}
            {{ form.urinary_catheter_date|as_crispy_field }}
            {{ form.urinary_catheter|as_crispy_field }}
            {{ form.surgical_dressing_intact|as_crispy_field }}
            {{ form.spectacle_walking_aid_denture|as_crispy_field }}
            {{ form.appointment_card_returned|as_crispy_field }}
            {{ form.own_medication_return|as_crispy_field }}
            {{ form.medication_reconcilation|as_crispy_field }}
            {{ form.medication_reconcilation_patient|as_crispy_field }}
            {{ form.given_by|as_crispy_field }}
        </div>

	</div>

	<div class="modal-footer">
		<button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
		<button type="submit" class="btn btn-primary"><i class="icon wb-plus" aria-hidden="true"></i>Submit</button>
	</div>

</form>

{% block js %}
<script type='text/javascript'>
$(document).ready(function()
{
    $('.myForm p').formset(

    {
        prefix: 'form',
//      prefix: '{{ formset.prefix }}',
        addCssClass: 'btn btn-success',
        addText: '<i class="fas fa-plus"></i>',
        deleteCssClass: 'btn btn-danger',
        deleteText: '<i class="fas fa-minus"></i>',
        keepFieldValues: '#id_form-0-date, #id_form-0-time, #id_form-0-done_by',
//      addContainerClass: 'tambah_row',
        added: function(row)
        {
            $(row).find('[id$="date"]').removeClass('datepickerinput').removeAttr('#id_form-0-date').removeData('DateTimePicker')
        .unbind().datetimepicker(
            options={
                "format": "DD-MM-YYYY",
            });

            $(row).find('[id$="time"]').removeClass('timepickerinput').removeAttr('#id_form-0-time').removeData('DateTimePicker')
        .unbind().datetimepicker(
            options={
                "format": "HH:mm",
            });

            $(row).find("#id_form-0-frequency").remove();
        },
    });

    $.extend(true, $.fn.datetimepicker.defaults, {
        icons: {
            time: 'far fa-clock',
            date: 'far fa-calendar',
            up: 'fas fa-arrow-up',
            down: 'fas fa-arrow-down',
            previous: 'fas fa-chevron-left',
            next: 'fas fa-chevron-right',
            today: 'fas fa-calendar-check',
            clear: 'far fa-trash-alt',
            close: 'far fa-times-circle'
        }
    });

    $("#id_date_time_0").datetimepicker(
        {
//              format: 'L',
            format:'DD-MM-YYYY',
//              defaultDate: currentDate,
            showTodayButton: true,
            showClear: true,
            showClose: true,
        }
    );
    $("#id_date_time_1").datetimepicker(
        {
//              format: 'LT',
            format: 'HH:mm'
        }
    );
});
</script>
{% endblock %}
